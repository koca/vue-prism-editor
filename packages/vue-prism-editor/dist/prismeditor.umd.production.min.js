!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],e):e((t=t||self).PrismEditor={},t.Vue)}(this,(function(t,e){"use strict";var i=void 0!==typeof self?self:this;function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n={"(":")","{":"}","[":"]",'"':'"',"'":"'"},o="navigator"in i&&/Win/i.test(navigator.platform),a="navigator"in i&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),r=e.extend({props:{lineNumbers:{type:Boolean,default:!1},autoStyleLineNumbers:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},value:{type:String,default:""},highlight:{type:Function,required:!0},tabSize:{type:Number,default:2},insertSpaces:{type:Boolean,default:!0},ignoreTabKey:{type:Boolean,default:!1},placeholder:{type:String,default:""},autocomplete:{type:Function,default:function(){return[]}}},data:function(){return{capture:!0,history:{stack:[],offset:-1},lineNumbersHeight:"20px",codeData:"",autocompleteOpen:!1,autocompleteIndex:0,autocompleteData:[]}},watch:{value:{immediate:!0,handler:function(t){this.codeData=t||""}},content:{immediate:!0,handler:function(){var t=this;this.lineNumbers&&this.$nextTick((function(){t.setLineNumbersHeight()}))}},lineNumbers:function(){var t=this;this.$nextTick((function(){t.styleLineNumbers(),t.setLineNumbersHeight()}))},autocompleteIndex:function(){var t=this;e.nextTick((function(){var e=t.$el.querySelector("ul.prism-editor__autocomplete > li.selected");e&&e.scrollIntoView({block:"nearest"})}))}},computed:{isEmpty:function(){return 0===this.codeData.length},content:function(){return this.highlight(this.codeData)+"<br />"},lineNumbersCount:function(){return this.codeData.split(/\r\n|\n/).length},cursorOffset:function(){var t=this.$refs.textarea,e=this.$refs.wrapper,i=this.codeData.substring(0,t.selectionEnd||0).split(/\r\n|\n/),s=parseFloat(getComputedStyle(t).getPropertyValue("font-size")),n=i.length;return[Math.min(8.85*i[i.length-1].length*(s/16)-e.scrollLeft,e.clientWidth-Math.min(240,e.clientWidth)),24*n*(s/16)+2-e.scrollTop]}},mounted:function(){this._recordCurrentState(),this.styleLineNumbers()},methods:{updateAutocompleteData:function(){var t,e="function"==typeof this.autocomplete?this.autocomplete(this.codeData,this.$refs.textarea.selectionEnd):[],i=this.autocompleteData.length;(t=this.autocompleteData).splice.apply(t,[0,Infinity].concat(e)),this.autocompleteOpen=!0,this.autocompleteIndex=Math.max(0,Math.min(this.autocompleteIndex,this.autocompleteData.length-1)),i>this.autocompleteData.length&&(this.autocompleteIndex=0)},acceptAutocomplete:function(t,i){var s=this;t.preventDefault(),null==i&&(i=this.autocompleteIndex);var n=this.$refs.textarea,o=this.$refs.wrapper,a=this.autocompleteData[i]||this.autocompleteData[0];if(a){var r=a.overlap||0,l=[this.codeData.substr(0,n.selectionEnd-r),a.text,this.codeData.substring(n.selectionEnd)].join(""),u=n.selectionEnd-r+a.text.length+(a.text.endsWith(")")?-1:0);n.selectionStart=n.selectionEnd=u,this._applyEdits({value:l,selectionStart:u,selectionEnd:u});var h=a.text.length-a.overlap;e.nextTick((function(){o.scrollLeft+=8.85*h})),a.text.endsWith(".")?setTimeout((function(){s.updateAutocompleteData()}),1):this.autocompleteOpen=!1}},setLineNumbersHeight:function(){this.lineNumbersHeight=getComputedStyle(this.$refs.pre).height},styleLineNumbers:function(){if(this.lineNumbers&&this.autoStyleLineNumbers){var t=this.$refs.pre,e=this.$el.querySelector(".prism-editor__line-numbers"),i=window.getComputedStyle(t);this.$nextTick((function(){var s="border-top-left-radius",n="border-bottom-left-radius";e&&(e.style[s]=i[s],e.style[n]=i[n],t.style[s]="0",t.style[n]="0",["background-color","margin-top","padding-top","font-family","font-size","line-height"].forEach((function(t){e.style[t]=i[t]})),e.style["margin-bottom"]="-"+i["padding-top"])}))}},_recordCurrentState:function(){var t=this.$refs.textarea;t&&this._recordChange({value:t.value,selectionStart:t.selectionStart,selectionEnd:t.selectionEnd})},_getLines:function(t,e){return t.substring(0,e).split("\n")},_recordStateIfChange:function(){this.history.stack[this.history.offset].value!=this.codeData&&this._recordChange({value:this.codeData,selectionStart:this.codeData.length,selectionEnd:this.codeData.length})},_applyEdits:function(t){var e=this.$refs.textarea,i=this.history.stack[this.history.offset];i&&e&&(this.history.stack[this.history.offset]=s({},i,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd})),this._recordChange(t),this._updateInput(t)},_recordChange:function(t,e){void 0===e&&(e=!1);var i=this.history,n=i.stack,o=i.offset;if(n.length&&o>-1){this.history.stack=n.slice(0,o+1);var a=this.history.stack.length;if(a>100){var r=a-100;this.history.stack=n.slice(r,a),this.history.offset=Math.max(this.history.offset-r,0)}}var l=Date.now();if(e){var u=this.history.stack[this.history.offset];if(u&&l-u.timestamp<3e3){var h,c,p=/[^a-z0-9]([a-z0-9]+)$/i,d=null===(h=this._getLines(u.value,u.selectionStart).pop())||void 0===h?void 0:h.match(p),f=null===(c=this._getLines(t.value,t.selectionStart).pop())||void 0===c?void 0:c.match(p);if(d&&f&&f[1].startsWith(d[1]))return void(this.history.stack[this.history.offset]=s({},t,{timestamp:l}))}}this.history.stack.push(s({},t,{timestamp:l})),this.history.offset++},_updateInput:function(t){var e=this.$refs.textarea;e&&(e.value=t.value,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,this.$emit("input",t.value))},handleChange:function(t){var e=t.target,i=e.value;this._recordChange({value:i,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},!0),this.$emit("input",i)},_undoEdit:function(){var t=this.history,e=t.offset,i=t.stack[e-1];i&&(this._updateInput(i),this.history.offset=Math.max(e-1,0))},_redoEdit:function(){var t=this.history,e=t.stack,i=t.offset,s=e[i+1];s&&(this._updateInput(s),this.history.offset=Math.min(i+1,e.length-1))},handleKeyDown:function(t){var e=this,i=this.tabSize,s=this.insertSpaces,r=this.ignoreTabKey;if(!this.$listeners.keydown||(this.$emit("keydown",t),!t.defaultPrevented)){if(9===t.keyCode&&this.autocompleteData.length&&this.autocompleteOpen)return this.acceptAutocomplete(t),t.preventDefault(),void t.stopPropagation();if(27===t.keyCode){if(this.autocompleteData.length&&this.autocompleteOpen)return t.preventDefault(),void(this.autocompleteOpen=!1)}else if(38===t.keyCode){if(this.autocompleteData.length&&this.autocompleteOpen)return t.preventDefault(),void(this.autocompleteIndex=(this.autocompleteIndex?this.autocompleteIndex:this.autocompleteData.length)-1)}else if(40===t.keyCode&&this.autocompleteData.length&&this.autocompleteOpen)return t.preventDefault(),void(this.autocompleteIndex=(this.autocompleteIndex+1)%this.autocompleteData.length);27===t.keyCode&&(t.target.blur(),this.$emit("blur",t));var l=t.target,u=l.value,h=l.selectionStart,c=l.selectionEnd,p=(s?" ":"\t").repeat(i);if(9===t.keyCode&&!r&&this.capture)if(t.preventDefault(),t.shiftKey){var d=this._getLines(u,h),f=d.length-1,m=this._getLines(u,c).length-1,y=u.split("\n").map((function(t,e){return e>=f&&e<=m&&t.startsWith(p)?t.substring(p.length):t})).join("\n");u!==y&&this._applyEdits({value:y,selectionStart:d[f].startsWith(p)?h-p.length:h,selectionEnd:c-(u.length-y.length)})}else if(h!==c){var g=this._getLines(u,h),v=g.length-1,b=this._getLines(u,c).length-1,_=g[v];this._applyEdits({value:u.split("\n").map((function(t,e){return e>=v&&e<=b?p+t:t})).join("\n"),selectionStart:/\S/.test(_)?h+p.length:h,selectionEnd:c+p.length*(b-v+1)})}else{var k=h+p.length;this._applyEdits({value:u.substring(0,h)+p+u.substring(c),selectionStart:k,selectionEnd:k})}else if(8===t.keyCode){var D=h!==c;if(u.substring(0,h).endsWith(p)&&!D){t.preventDefault();var x=h-p.length;this._applyEdits({value:u.substring(0,h-p.length)+u.substring(c),selectionStart:x,selectionEnd:x})}}else if(13===t.keyCode){if(this.autocompleteData.length&&this.autocompleteOpen)this.acceptAutocomplete(t);else if(h===c){var E=this._getLines(u,h).pop(),C=null==E?void 0:E.match(/^\s+/);if(C&&C[0]){t.preventDefault();var S="\n"+C[0],$=h+S.length;this._applyEdits({value:u.substring(0,h)+S+u.substring(c),selectionStart:$,selectionEnd:$})}}}else n[t.key]?h!==c&&(t.preventDefault(),this._applyEdits({value:u.substring(0,h)+t.key+u.substring(h,c)+n[t.key]+u.substring(c),selectionStart:h+1,selectionEnd:c+1})):!(a?t.metaKey&&90===t.keyCode:t.ctrlKey&&90===t.keyCode)||t.shiftKey||t.altKey?(a?t.metaKey&&90===t.keyCode&&t.shiftKey:o?t.ctrlKey&&89===t.keyCode:t.ctrlKey&&90===t.keyCode&&t.shiftKey)&&!t.altKey?(t.preventDefault(),this._redoEdit()):77!==t.keyCode||!t.ctrlKey||a&&!t.shiftKey||(t.preventDefault(),this.capture=!this.capture):(t.preventDefault(),this._undoEdit());13!==t.keyCode&&9!==t.keyCode&&setTimeout((function(){e.updateAutocompleteData()}),1)}}},render:function(t){var e=this,i=t("div",{attrs:{class:"prism-editor__line-width-calc",style:"height: 0px; visibility: hidden; pointer-events: none;"}},"999"),s=t("div",{staticClass:"prism-editor__line-numbers",style:{"min-height":this.lineNumbersHeight},attrs:{"aria-hidden":"true"}},[i,Array.from(Array(this.lineNumbersCount).keys()).map((function(e,i){return t("div",{attrs:{class:"prism-editor__line-number token comment"}},""+ ++i)}))]),n=this.autocompleteOpen&&this.autocompleteData.length?t("ul",{staticClass:"prism-editor__autocomplete",style:{left:this.cursorOffset[0]+"px",top:this.cursorOffset[1]+"px"}},this.autocompleteData.map((function(i,s){return t("li",{key:i.text,class:{selected:s==e.autocompleteIndex},on:{mousedown:function(t){e.acceptAutocomplete(t,s)}}},[i.label||i.text])}))):void 0,o=t("textarea",{ref:"textarea",on:{input:this.handleChange,keydown:this.handleKeyDown,click:function(t){e.autocompleteOpen=!1,e.$emit("click",t)},keyup:function(t){e.$emit("keyup",t)},focus:function(t){e._recordStateIfChange(),e.$emit("focus",t)},blur:function(t){e.autocompleteOpen=!1,e.$emit("blur",t)}},staticClass:"prism-editor__textarea",class:{"prism-editor__textarea--empty":this.isEmpty},attrs:{spellCheck:"false",autocapitalize:"off",autocomplete:"off",autocorrect:"off","data-gramm":"false",placeholder:this.placeholder,"data-testid":"textarea",readonly:this.readonly},domProps:{value:this.codeData}}),a=t("pre",{ref:"pre",staticClass:"prism-editor__editor",attrs:{"data-testid":"preview"},domProps:{innerHTML:this.content}}),r=t("div",{staticClass:"prism-editor__container"},[o,a]),l=t("div",{staticClass:"prism-editor-wrapper",ref:"wrapper"},[this.lineNumbers&&s,r]);return t("div",{staticClass:"prism-editor-component"},[l,n])}});t.PrismEditor=r,Object.defineProperty(t,"__esModule",{value:!0});let l=null;"undefined"!=typeof window?l=window.Vue:void 0!==i&&(l=i.Vue),l&&l.component("PrismEditor",r)}));
//# sourceMappingURL=prismeditor.umd.production.min.js.map
